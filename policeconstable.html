<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Police Constable Quiz</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* --- 1. CSS VARIABLES WITH DARK MODE SUPPORT --- */
:root{
  /* Light Theme (Default) */
  --primary:#0f766e; 
  --primary-light:#ccfbf1; 
  --primary-dark:#115e59;
  --bg-color:#f1f5f9; 
  --white:#fff; 
  --text-main:#0f172a; 
  --text-sub:#64748b;
  --shadow:0 4px 6px -1px rgba(0,0,0,0.1);
  --btn-bg: #f8fafc;
  --border: #e2e8f0;
}

/* Dark Theme Overrides */
[data-theme="dark"] {
  --primary: #2dd4bf;       /* Brighter Teal */
  --primary-light: #134e4a; /* Dark Teal BG */
  --primary-dark: #064e3b;
  --bg-color: #0f172a;      /* Dark Slate Body */
  --white: #1e293b;         /* Slate 800 Cards */
  --text-main: #f1f5f9;     /* White Text */
  --text-sub: #94a3b8;      /* Light Gray */
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
  --btn-bg: #0f172a;        /* Dark Button Bg */
  --border: #334155;
}

body{font-family:Segoe UI, Roboto, sans-serif;background:var(--bg-color);margin:0;display:flex;justify-content:center;color:var(--text-main);transition:background 0.3s, color 0.3s;}
.app-container{width:100%;max-width:500px;background:var(--white);min-height:100vh;box-shadow:0 0 20px rgba(0,0,0,0.05);display:flex;flex-direction:column;transition:background 0.3s;}

/* Header */
.header{background:linear-gradient(135deg,var(--primary-dark),var(--primary));color:#fff;padding:30px 20px 40px;border-bottom-left-radius:24px;border-bottom-right-radius:24px;position:relative;box-shadow:0 4px 15px rgba(15,118,110,0.2);}
.header a{color:rgba(255,255,255,0.9);text-decoration:none;font-size:14px;position:absolute;top:20px;left:20px;font-weight:600;}
.header h1{margin:15px 0 5px;font-size:24px;font-weight:700}
.header p{margin:0;opacity:.9;font-size:14px}

/* Dark Mode Button */
.theme-btn {
    position: absolute; top: 15px; right: 20px;
    background: rgba(255,255,255,0.2); border: none; cursor: pointer;
    width: 35px; height: 35px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; color: white; transition: 0.2s; backdrop-filter: blur(5px);
}
.theme-btn:hover { background: rgba(255,255,255,0.3); transform: rotate(15deg); }

.screen{display:none;padding:25px;flex-grow:1;}
.active{display:block}

/* Cards */
.menu-card{background:var(--white);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:15px;cursor:pointer;display:flex;align-items:center;transition:.2s;box-shadow:var(--shadow);}
.menu-card:hover{border-color:var(--primary);background:var(--primary-light);color:var(--text-main);}

.question-card{background:var(--white);border:1px solid var(--border);border-radius:16px;padding:25px;margin-bottom:20px;box-shadow:var(--shadow);}
.q-text{font-size:18px;font-weight:600;margin-bottom:20px;color:var(--text-main);}

/* Options */
.opt-btn{display:block;width:100%;padding:15px;margin-bottom:10px;border:1px solid var(--border);background:var(--btn-bg);border-radius:12px;cursor:pointer;color:var(--text-main);transition:0.2s;}
.opt-btn:hover{border-color:var(--primary);}

.opt-btn.correct{background:#dcfce7!important;border-color:#22c55e!important;color:#14532d!important}
.opt-btn.wrong{background:#fee2e2!important;border-color:#ef4444!important;color:#7f1d1d!important}

/* Dark mode specific feedback colors for readability */
[data-theme="dark"] .opt-btn.correct { background: #064e3b !important; color: #d1fae5 !important; border-color: #34d399 !important; }
[data-theme="dark"] .opt-btn.wrong { background: #450a0a !important; color: #fecaca !important; border-color: #f87171 !important; }

/* Buttons */
.action-btn{background:var(--primary);color:#fff;border:none;padding:16px;width:100%;border-radius:12px;font-size:16px;margin-top:10px;cursor:pointer;transition:0.2s;}
.action-btn:hover{opacity:0.9;}
.action-btn.secondary-btn{background:var(--text-sub)}
.action-btn.review-btn{background:#3b82f6}
.action-btn.share-btn{background:#25D366}

#timer-box{text-align:right;font-size:18px;color:#dc2626;margin-bottom:10px}
.review-item{border-bottom:1px solid var(--border);padding:15px 0}
.explanation{background:var(--primary-light);padding:10px;border-radius:8px;margin-top:5px;color:var(--primary-dark);font-size:13px}
#loading-msg{text-align:center;color:var(--text-sub);margin-top:20px}
</style>
</head>
<body>

<div class="app-container">
  <div class="header">
    <a href="index.html">‚Üê Home</a>
    <button class="theme-btn" onclick="toggleTheme()">üåì</button>
    
    <h1>Police Constable</h1>
    <p>GK ‚Ä¢ Reasoning ‚Ä¢ Math ‚Ä¢ Computer</p>
  </div>

  <div id="screen-modes" class="screen active">
    <h3 style="color:var(--text-sub);margin-bottom:20px;">Select Mode</h3>
    <div id="loading-msg">Loading Question Bank...</div>

    <div id="btn-practice" class="menu-card" style="opacity:.5;pointer-events:none">
      <span style="font-size:24px;margin-right:15px">üìù</span>
      <div><b>Practice Mode</b><br><span style="font-size:13px;color:var(--text-sub)">Instant Answer</span></div>
    </div>

    <div id="btn-exam" class="menu-card" style="opacity:.5;pointer-events:none">
      <span style="font-size:24px;margin-right:15px">‚è±Ô∏è</span>
      <div><b>Exam Mode</b><br><span style="font-size:13px;color:var(--text-sub)">Timed Test</span></div>
    </div>
  </div>

  <div id="screen-quiz" class="screen">
    <div id="timer-box">‚è≥ <span id="time-left">00:00</span></div>
    <div class="question-card">
      <div style="font-size:13px;color:var(--text-sub);margin-bottom:10px;">Question <span id="q-num">1</span></div>
      <div id="q-text" class="q-text">Loading...</div>
      <div id="opts"></div>
    </div>
    <div id="feedback" style="text-align:center;margin-bottom:10px;font-size:16px;font-weight:600"></div>
  </div>

  <div id="screen-result" class="screen" style="text-align:center">
    <h2>Score Card</h2>
    <h1 id="score" style="font-size:48px;color:var(--primary)">0/0</h1>
    <p id="result-msg" style="color:var(--text-sub);font-size:18px"></p>
    <button class="action-btn review-btn" onclick="showReview()">Review Answers</button>
    <button class="action-btn share-btn" onclick="shareScore()">Share Score</button>
    <button class="action-btn secondary-btn" onclick="goToMenu()">Back to Menu</button>
  </div>

  <div id="screen-review" class="screen">
    <h3>Review Answers</h3>
    <div id="review-list" style="max-height:60vh;overflow-y:auto"></div>
    <button class="action-btn secondary-btn" onclick="closeReview()">Close</button>
  </div>
</div>

<script>
/* ======= GOOGLE SHEET CSV LINKS ======= */
const SHEET_URLS = {
  en: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=0&single=true&output=csv",
  hi: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=360464023&single=true&output=csv",
  mr: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=167861512&single=true&output=csv",
  bn: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=354284516&single=true&output=csv",
  ta: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=426655728&single=true&output=csv",
  te: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbss64i39-2Fs8rayRzELr42HkOLkVE73rwCg-h9mkHgj88DJzfPcoUBxwTcN9Vf9-Re_1IZgXeXXp/pub?gid=777874548&single=true&output=csv"
};
/* ======================================= */

const lang = new URLSearchParams(window.location.search).get("lang") || "en";
let masterData = [], questions = [], userAnswers = [];
let idx = 0, score = 0, timerInterval;

// --- 3. DARK MODE JS LOGIC ---
function toggleTheme() {
    const body = document.body;
    const isDark = body.getAttribute('data-theme') === 'dark';
    if (isDark) {
        body.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
    } else {
        body.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
    }
}
// Apply on load
if(localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');

function loadData(){
  Papa.parse(SHEET_URLS[lang], {
    download:true,
    header:true,
    skipEmptyLines:true,
    complete: res => {
      masterData = res.data.filter(r => r.q);
      document.getElementById("loading-msg").style.display = "none";
      enableMenus();
    }
  });
}
loadData();

function enableMenus(){
  document.getElementById("btn-practice").style.opacity = "1";
  document.getElementById("btn-practice").style.pointerEvents = "auto";
  document.getElementById("btn-exam").style.opacity = "1";
  document.getElementById("btn-exam").style.pointerEvents = "auto";

  document.getElementById("btn-practice").onclick = startPractice;
  document.getElementById("btn-exam").onclick = startExam;
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    let j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function startPractice(){
  questions = shuffle([...masterData]).slice(0,5);
  beginQuiz(false);
}

function startExam(){
  questions = shuffle([...masterData]).slice(0,30);
  beginQuiz(true);
}

function beginQuiz(timed){
  idx=0; score=0; userAnswers=[];
  document.getElementById("screen-modes").classList.remove("active");
  document.getElementById("screen-result").classList.remove("active");
  document.getElementById("screen-review").classList.remove("active");
  document.getElementById("screen-quiz").classList.add("active");

  document.getElementById("timer-box").style.display = timed ? "block" : "none";
  if(timed) startTimer(600);

  loadQ();
}

function loadQ(){
  if(idx >= questions.length) return showResult();

  let q = questions[idx];
  document.getElementById("q-num").innerText = idx+1;
  document.getElementById("q-text").innerText = q.q;

  const opts = [q.o1, q.o2, q.o3, q.o4];
  const correct = parseInt(q.a)-1;

  let box = document.getElementById("opts");
  box.innerHTML = "";
  document.getElementById("feedback").innerText = ""; // Clear feedback

  let btns = [];

  opts.forEach((txt,i)=>{
    let b=document.createElement("button");
    b.className="opt-btn";
    b.innerText = txt;

    btns.push(b);

    b.onclick = ()=>{
      btns.forEach(bb=>bb.disabled=true);

      userAnswers.push({ q:q.q, opts, sel:i, cor:correct, exp:q.explain });

      if(i===correct){
        b.classList.add("correct");
        score++;
        showFeedback("Correct","green");
      } else {
        b.classList.add("wrong");
        btns[correct].classList.add("correct");
        showFeedback("Wrong","red");
      }

      setTimeout(()=>{ idx++; loadQ(); },1000);
    };

    box.appendChild(b);
  });
}

function showFeedback(text,color){
  let fb=document.getElementById("feedback");
  fb.innerText=text;
  // In dark mode we might want lighter text, but direct colors work ok here
  fb.style.color = (document.body.getAttribute('data-theme') === 'dark' && color === 'green') ? '#34d399' : color;
  if(color === 'red' && document.body.getAttribute('data-theme') === 'dark') fb.style.color = '#f87171';
}

function showResult(){
  clearInterval(timerInterval);

  document.getElementById("screen-quiz").classList.remove("active");
  document.getElementById("screen-result").classList.add("active");

  document.getElementById("score").innerText = score+"/"+questions.length;
  let pct = Math.round(score/questions.length*100);

  let msg = document.getElementById("result-msg");
  if(pct>=80){
    msg.innerText = "Excellent!";
    msg.style.color="var(--primary)";
    confetti({particleCount:150, spread:70});
  } else {
    msg.innerText = "Keep Practicing!";
    msg.style.color="var(--text-sub)";
  }
}

function showReview(){
  document.getElementById("screen-result").classList.remove("active");
  document.getElementById("screen-review").classList.add("active");

  let list=document.getElementById("review-list");
  list.innerHTML="";

  userAnswers.forEach((it,i)=>{
    let div=document.createElement("div");
    div.className="review-item";

    // Dynamic Success/Fail Icons
    let statusIcon = (it.sel === it.cor) ? "‚úÖ" : "‚ùå";

    div.innerHTML = `
      <b>${i+1}. ${it.q}</b><br>
      Your Answer: <b>${it.opts[it.sel]}</b> ${statusIcon}<br>
      ${it.sel !== it.cor ? `<div style="color:var(--primary); font-weight:bold; margin-top:4px;">Correct: ${it.opts[it.cor]}</div>` : ""}
      ${it.exp ? `<div class="explanation">üí° ${it.exp}</div>` : ""}
    `;

    list.appendChild(div);
  });
}

function closeReview(){
  document.getElementById("screen-review").classList.remove("active");
  document.getElementById("screen-result").classList.add("active");
}

function goToMenu(){
  document.getElementById("screen-result").classList.remove("active");
  document.getElementById("screen-modes").classList.add("active");
}

function shareScore(){
  window.open("https://wa.me/?text="+encodeURIComponent("I scored "+score+"/"+questions.length+" in Police Constable Quiz! Try it here."));
}

function startTimer(t){
  function update(){
    let m=("0"+Math.floor(t/60)).slice(-2);
    let s=("0"+(t%60)).slice(-2);
    document.getElementById("time-left").innerText=m+":"+s;
  }
  update();
  timerInterval=setInterval(()=>{
    t--;
    update();
    if(t<0){
      clearInterval(timerInterval);
      showResult();
    }
  },1000);
}
</script>

</body>
</html>
